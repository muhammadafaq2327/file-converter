// ========== script.js for Smart Online File Converter ==========

document.getElementById('convertBtn').addEventListener('click', async () => {
    const fileInput = document.getElementById('fileInput');
    const outputType = document.getElementById('outputType').value;
    const statusMessage = document.getElementById('statusMessage');

    if (!fileInput.files.length) {
        alert('Please select a file.');
        return;
    }

    const file = fileInput.files[0];

    try {
        statusMessage.textContent = 'Processing...';

        if (outputType === 'imageToPDF') {
            // Image → PDF
            const img = await file.arrayBuffer();
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            const imgData = new Uint8Array(img);
            pdf.addImage(imgData, 'JPEG', 10, 10, 180, 160);
            pdf.save(file.name.split('.')[0] + '.pdf');
            statusMessage.textContent = 'Image converted to PDF successfully!';
        } else if (outputType === 'imageToText') {
            // Image → Text (OCR)
            const textResult = await Tesseract.recognize(file, 'eng');
            const blob = new Blob([textResult.data.text], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = file.name.split('.')[0] + '.txt';
            link.click();
            statusMessage.textContent = 'Image converted to Text successfully!';
        } else if (outputType === 'pdfEdit') {
            // PDF Edit (Remove last page)
            const existingPdfBytes = await file.arrayBuffer();
            const pdfDoc = await PDFLib.PDFDocument.load(existingPdfBytes);
            const totalPages = pdfDoc.getPageCount();
            pdfDoc.removePage(totalPages - 1);
            const pdfBytes = await pdfDoc.save();
            const blob = new Blob([pdfBytes], { type: 'application/pdf' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = file.name.split('.')[0] + '_edited.pdf';
            link.click();
            statusMessage.textContent = 'PDF edited successfully!';
        } else if (outputType === 'pdfToImage') {
            // Paid feature placeholder
            alert('PDF to Image conversion is under development. Paid feature coming soon!');
            statusMessage.textContent = 'Paid feature placeholder';
        }
    } catch (err) {
        console.error(err);
        statusMessage.textContent = 'Error during conversion. Check console for details.';
    }
});
